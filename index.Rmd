---
title: ""
output:
  html_document:
    theme: yeti
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
---
<br>  

###Introduction to desert niches
**A systematic review of positive interactions and the niche in deserts.**  
The niche is a powerful concept in ecology and at times not entirely coupled to local interactions between species. Herein, we review the capacity for these positive plant interactions to expand the niche of subdominant species. We synthesized the available literature using a formalized systematic review by using the Web of Science and associated terms with niche, positive interactions in plants such as facilitation, and deserts.  
<br>  

![](./desert.jpg)  
<br>

###Literature search & sort
```{r, literature, warning=FALSE, message=FALSE}
library(tidyverse)
library(DT)

#Search terms####
search.terms <- read_csv("data/search.terms.csv")
datatable(search.terms)

total.lit <- search.terms %>% filter(search != "final")
total.lit
totals <- sum(total.lit$hits)
totals
final.list <- 53
totals-final.list


#PRISMA####
#use 'prisma' function from PRISMAstatement 
#https://cran.r-project.org/web/packages/PRISMAstatement/vignettes/PRISMA.html
prisma.report <-read_csv("data/prisma.csv")
prisma.report
exclusions <- prisma.report %>% filter(inclusion == "N") %>% select(ID, category)
dim(exclusions)

library(PRISMAstatement)
#first search (2015)
prisma(found = 156,
       found_other = 0,
       no_dupes = 53, 
       screened = 53, 
       screen_exclusions = 0, 
       full_text = 53,
       full_text_exclusions = 24, 
       qualitative = 0, 
       quantitative = 29,
       width = 800, height = 800)

#second search (2017)
prisma(found = 196,
       found_other = 0,
       no_dupes = 70, 
       screened = 70, 
       screen_exclusions = 0, 
       full_text = 70,
       full_text_exclusions = 34, 
       qualitative = 0, 
       quantitative = 36,
       width = 800, height = 800)

#Summary of exclusions
categories <- exclusions %>% group_by(category) %>% tally() %>% arrange(desc(n))
categories

ggplot(categories, aes(category, n)) + geom_bar(stat = "identity") + coord_flip() + ylim(0,10)

```

###Search contrasts using DOI-matcher
```{r DOI matcher, warning=FALSE, message=FALSE}
search.1.1 <- read_csv("data/2016-search-total.csv")
search.1.2 <- read_csv("data/2017-search.csv")
net.difference <- anti_join(search.1.2, search.1.1, by = "DOI")
#net.difference <- net.difference %>% select(Title, DOI) #to simplify for a look
nrow(net.difference) #count of number of differences from consecutive search
#write_csv(net.difference, "data/net.difference.csv")

#double-check
net.difference <- anti_join(search.1.2, search.1.1, by = "Title")
nrow(net.difference)

```


###Evidence synthesis
```{r synthesis, warning=FALSE, message=FALSE}
data <- read_csv("data/data.csv")
data

#map####
#ggplot2 vers
require(maps)
world<-map_data("world")
map<-ggplot() + geom_polygon(data=world, fill="gray50", aes(x=long, y=lat, group=group))
map + geom_point(data=data, aes(x=long, y=lat)) + labs(x = "longitude", y = "latitude")

#data viz
data.simple <- data %>% group_by(niche.concept, ecosystem) %>% count()

ggplot(na.omit(data.simple), aes(niche.concept, n)) + geom_bar(stat = "identity") + coord_flip() + scale_fill_brewer(palette = "Blues") + labs(x = "niche concept", y =" count")

ggplot(na.omit(data.simple), aes(niche.concept, n, fill = ecosystem)) + geom_bar(stat = "identity") + coord_flip() + scale_fill_brewer(palette = "Blues") #too many levels

#data <- data %>% 
    #rowwise() %>% 
    #mutate(matches = sub("semi-arid", "semi-arid", ecosystem))    

#now, do we need stats? if more >= 5
36/5 #yes
c1<-chisq.test(data.simple$niche.concept, data.simple$n, simulate.p.value = TRUE, B = 10000)
c1 #n.s.

n_distinct(data$country)
n_distinct(data$niche.concept)
n_distinct(data$ecosystem)


```

###Interpretation  
1. Map of world and total of 11 different countries show that concept of niche not extensively tested in field globally.  
2. A total of 5 distinct niche concepts tested across 12 different ecosystems. This suggests an excellent start to field research on topic at this level with deserts.  

